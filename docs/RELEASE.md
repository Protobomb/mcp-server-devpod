# Release Guide

This document explains how to create releases for the MCP DevPod server.

## Automated Release Process

The project uses GitHub Actions to automatically build and publish releases when a git tag is pushed.

### Creating a Release

1. **Ensure main branch is ready**:
   ```bash
   git checkout main
   git pull origin main
   ```

2. **Create and push a tag**:
   ```bash
   git tag v1.0.0
   git push origin v1.0.0
   ```

3. **Monitor the release workflow**:
   - Go to [GitHub Actions](https://github.com/Protobomb/mcp-server-devpod/actions)
   - Watch the "Release" workflow complete
   - Check the [Releases page](https://github.com/Protobomb/mcp-server-devpod/releases) for the new release

### What Gets Built

The release workflow automatically creates:

- **Cross-platform binaries**:
  - `mcp-server-devpod-linux-amd64.tar.gz`
  - `mcp-server-devpod-linux-arm64.tar.gz`
  - `mcp-server-devpod-darwin-amd64.tar.gz`
  - `mcp-server-devpod-darwin-arm64.tar.gz`
  - `mcp-server-devpod-windows-amd64.zip`

- **Docker images**:
  - `ghcr.io/protobomb/mcp-server-devpod:v1.0.0`
  - `ghcr.io/protobomb/mcp-server-devpod:latest`

- **GitHub release** with:
  - Automatic release notes
  - All binary archives
  - Docker pull instructions

## Manual Testing

### Local Binary Builds

Test the build system locally:

```bash
# Build for current platform
make build VERSION=v1.0.0-test

# Build all platforms
make build-release VERSION=v1.0.0-test

# Test the binary
./dist/mcp-server-devpod-linux-amd64 --version
```

### Manual Docker Builds

Test Docker builds without releasing:

1. Go to [GitHub Actions](https://github.com/Protobomb/mcp-server-devpod/actions)
2. Select "Manual Docker Build" workflow
3. Click "Run workflow"
4. Choose:
   - **Tag**: `test` (or any tag you want)
   - **Push to registry**: `false` (for testing) or `true` (to publish)

### Local Docker Testing

```bash
# Build locally
make docker-build VERSION=test

# Test the image
docker run ghcr.io/protobomb/mcp-server-devpod:test --version
```

## Version Management

### Version Format

Use semantic versioning: `vMAJOR.MINOR.PATCH`

- `v1.0.0` - Major release
- `v1.1.0` - Minor release (new features)
- `v1.0.1` - Patch release (bug fixes)
- `v1.0.0-rc1` - Release candidate
- `v1.0.0-beta1` - Beta release

### Pre-releases

For pre-releases (alpha, beta, rc), the workflow will mark them as "pre-release" on GitHub.

## Troubleshooting

### Release Workflow Fails

1. Check the [Actions tab](https://github.com/Protobomb/mcp-server-devpod/actions) for error details
2. Common issues:
   - **Build failures**: Check Go version compatibility
   - **Docker failures**: Verify Dockerfile syntax
   - **Permission errors**: Ensure GITHUB_TOKEN has package write permissions

### Missing Binaries

If some platform binaries are missing:
1. Check if the build matrix in `.github/workflows/release.yml` includes all platforms
2. Verify cross-compilation works locally: `GOOS=windows GOARCH=amd64 go build main.go`

### Docker Push Failures

If Docker publishing fails:
1. Verify the repository has package write permissions
2. Check if the image name matches the repository name
3. Ensure the workflow has `packages: write` permission

## Build Scripts

### `scripts/build-release.sh`

Cross-platform build script used by CI and available for local testing:

```bash
# Usage
./scripts/build-release.sh [version]

# Examples
./scripts/build-release.sh v1.0.0
./scripts/build-release.sh dev
```

### Makefile Targets

- `make build` - Build for current platform
- `make build-all` - Build for all platforms
- `make build-release` - Build with archives (uses build-release.sh)
- `make docker-build` - Build Docker image
- `make docker-push` - Build and push Docker image

## Security Notes

- The release workflow uses `GITHUB_TOKEN` for authentication
- Docker images are published to GitHub Container Registry (ghcr.io)
- All builds are reproducible and use pinned action versions
- Binary checksums are automatically generated by GitHub